{% extends 'base.html' %}
{% block body %}
  <h1 class="mb-4">Status das Solicitações</h1>
  <div class="mb-3 col-md-4">
    <label for="status-filter" class="form-label">Filtrar por Status</label>
    <select id="status-filter" class="form-select">
      <option value="">Todos</option>
      <option value="analise">Em análise</option>
      <option value="aprovado">Aprovado</option>
      <option value="compras">Compras</option>
    </select>
  </div>
  <table id="status-table" class="table table-striped">
    <thead>
      <tr>
        <th>ID</th>
        <th>Obra</th>
        <th>Status</th>
        <th>Ações</th>
      </tr>
    </thead>
    <tbody>
    {% for sol in solicitacoes %}
      <tr data-status="{{ sol.status }}">
        <td>{{ sol.id }}</td>
        <td>{{ sol.obra }}</td>
        <td>
          {% if sol.status == 'analise' %}
            Em análise
          {% else %}
            {{ sol.status }}
          {% endif %}
        </td>
        <td>
          <form method="post" action="{{ url_for('projetista.delete_solicitacao', id=sol.id) }}" onsubmit="return confirm('Confirma apagar?');">
            <button type="submit" class="btn btn-sm btn-danger">Apagar</button>
          </form>
        </td>
      </tr>
    {% else %}
      <tr>
        <td colspan="4" class="text-muted">Nenhuma solicitação registrada.</td>
      </tr>
    {% endfor %}
    </tbody>
  </table>

  <script>
    const select = document.getElementById('status-filter');
    select.addEventListener('change', () => {
      const val = select.value;
      document.querySelectorAll('#status-table tbody tr').forEach(row => {
        if (!val || row.dataset.status === val) {
          row.style.display = '';
        } else {
          row.style.display = 'none';
        }
      });
    });
  </script>
{% endblock %}
